<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../css/01.css">
</head>

<body>
    <div id="box">
        <div class="imglist">
            <ul>
                <li><img src="../img/222.jpg" alt=""></li>
                <li><img src="../img/lin44.gif" alt=""></li>
                <li><img src="../img/list1.gif" alt=""></li>
                <li><img src="../img/list2.gif" alt=""></li>
                <li><img src="../img/lsy.gif" alt=""></li>
                <li><img src="../img/tb1.jpg" alt=""></li>
            </ul>
        </div>
        <p class="light"></p>
        <div class="btn">
            <p class="prev">&lt;</p>
            <p class="next">&gt;</p>
        </div>
    </div>
</body>
<script src="../js/comm.js"></script>
<script>
    (function () {
        /*
        1.结构：   div
               ul li 图片
               p span 焦点
               p 按钮

            2.样式css
            -图片叠在可视区  -超出隐藏 -焦点有一个高亮的样式
            3.js
              -利用可视区两侧的位置实现轮播图：旧图挪走，新图进场

       需求：轮播图
           * 所有的图片放在右侧，第一张图放在可视区
           * 焦点(幻灯片)动态生成（根据图片的个数来创建）
           * 开启定时器：自动轮播
           * 点击左右按钮：切换到上下张
           * 点击焦点：切换到对应的图片
   */
        var box = document.getElementById('box');
        var ils = box.getElementsByTagName('li');
        var light = box.getElementsByClassName('light')[0];
        var lastBtn = box.getElementsByClassName('prev')[0];
        var nextBtn = box.getElementsByClassName('next')[0];
        var iw = ils[0].offsetWidth;
        var timer = null;
        var now = 0;//可视区里面图片的下标

        //1.所有的图片放在右侧，第一张图放在可视区
        //2.焦点(幻灯片)动态生成（根据图片的个数来创建）
        var html = '';
        for (var i = 0; i < ils.length; i++) {
            ils[i].style.left = iw + 'px';
            html += `<span>${i + 1}</span>`;
        }
        ils[0].style.left = 0;
        light.innerHTML = html;
        light.children[0].className = 'active';

        // //3.开启定时器：自动轮播
        
        // 切换下一张
        function next() {
            // 旧图移走，新图进场
            startMove(ils[now], { 'left': -iw });
            now++;
            if (now > ils.length - 1) {
                now = 0;
            }
            ils[now].style.left = iw + 'px';//候场
            startMove(ils[now], { 'left': 0 });
            lightMove();//焦点跟随
        }
        
         // 切换上一张
         function last() {//上一张
            //旧图挪走，新图进场
            startMove(ils[now], { 'left': iw });
            //新图:快速放在左侧，再挪到可视区
            now--;
            if (now < 0) {//临界值
                now = imglist.length - 1;
            }
            ils[now].style.left = -iw + 'px';//候场
            startMove(ils[now], { 'left': 0 });
            lightMove();//焦点跟随
        }
        
        // 设置焦点
        function lightMove() {
            // 排他
            for (var i = 0; i < light.children.length; i++) {
                light.children[i].className = '';
            }
            light.children[now].className = 'active';
        }
        //4.点击左右按钮：切换到上下张
        //鼠标移入停止，移出要继续运动
        box.onmouseover = function () {
            clearInterval(timer);
        }
        box.onmouseout = function () {
            clearInterval(timer);
            timer = setInterval(next, 2000);//每隔两秒切换一个图片
        }
        lastBtn.onclick = function () {
            //上一张
            last();
        }
        nextBtn.onclick = function () {
            //下一张
            next();
        }
        timer = setInterval(next, 2000);
        //5.点击焦点：切换到对应的图片
        light.onclick = function (ev) {
            if (ev.target.tagName.toLowerCase() == 'span') {
                var index = ev.target.innerHTML - 1;
                if (index > now) {
                    //新图从右边切入
                    startMove(ils[now], { 'left': -iw });
                    ils[index].style.left = iw + 'px';
                    startMove(ils[index], { 'left': 0 });
                }
                if (index < now) {
                    //新图从左边切入
                    startMove(ils[now], { 'left': iw });
                    ils[index].style.left = -iw + 'px';
                    startMove(ils[index], { 'left': 0 });
                }
                now = index;
                lightMove();//焦点跟随
            }
        }
    })();
</script>

</html>