<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>注册页面</title>
    <link rel="stylesheet" href="../css/reg.css">
    <link rel="stylesheet" href="../font_1436313_99rfors6bsd/iconfont.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/drag.css">
</head>

<body>
    <div class="top">
        <div class="content">
            <span class="favorite"><i></i><a href="">收藏商城</a></span>
            <ul class="quick_list">
                <li class="loginbar">您好！欢迎来到商城！<a href="/login">[登录]</a>&nbsp;<a href="javascript:regist()">[免费注册]</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="top-logo">
        <div class="content">
            <div id="logo"><a href="/"><img src="../img/zhongjiuloginlog -1.png" alt="商城" height="60"></a>
                <b>欢迎注册</b></div>
        </div>
    </div>



    <div class="content" id="reglist">
        <div class="reg">
            <div class="extra"><span>我已经注册，现在就&nbsp;<a href="/login" class="flk13">登录</a></span></div>
        </div>
        <div class="mcenter" id="regist">
            <form id="login" action="" method="post">
                <!-- 输入手机号码 -->
                <div class="item" id="select-cellPhone">
                    <span class="masie">手机号码：</span>
                    <div class="intelligent-cellPhone">
                        <input type="text" placeholder="" id="cellPhone" />
                        <span id="inf1" class="iconfont icon-gouwuche"></span><br />
                        <span id="cellPhone_info" class="focus" style="display: none">请输入手机号码</span>
                        <span id="cellPhone_error" class="error" style="display: none">请输入手机号码</span>
                    </div>

                </div>
                <!-- 滑块验证 -->
                <span class="masie">滑块验证：</span>
                <div id="texting">
                    <div class="huakuai">
                        <span class="sp1"></span><span class="sp2">>></span>
                    </div>
                    <div class="box">
                        <span class="txtRoll" class="labelTip">按住滑块，拖拽到最右边</span>
                    </div>
                </div>
                <!-- 设置密码 -->
                <div class="item" id="o-password">
                    <span class="masie">请设置密码：</span>
                    <div class="intelligent-password">
                        <input type="password" placeholder="" id="pwd" />
                        <span id="inf1" class="iconfont icon-gouwuche"></span><br />
                        <span id="pwd-info" class="focus" style="display: none">6-20位字符，可使用字母、数字或符号的组合</span>
                        <span id="pwd_error" class="error" style="display: none">密码长度只能在6-20位字符之间，不包含空格</span>
                    </div>
                </div>
                <!-- 密码确认 -->
                <div class="item" id="o-pwdRepeat">
                    <span class="masie">请确认密码：</span>
                    <div class="intelligent-password">
                        <input type="password" placeholder="" id="pwdRepeat_succeed" />
                        <span id="inf1" class="iconfont icon-gouwuche"></span><br />
                        <span id="Repeat_succeed" class="focus" style="display: none">请再次输入密码</span>
                        <span id="pwdRepeat_error" class="error" style="display: none">两次密码不一致</span>
                    </div>
                </div>
                <!-- 同意按钮 -->

                <div class="check">
                    <label><input type="checkbox" class="checkbox"  id="readme">我已阅读并同意《<a href=""  style="color:#e3393c" id="protocol">用户注册协议</a>》</label>
                    <label><span>请仔细阅读并同意以上协议</span></label>
                    <span class="clr"></span>
                </div>

                <!-- 注册按钮 -->
                <div class="item zc" name="__divregister">
                    <span class="zhuce">&nbsp;</span>
                    <input type="hidden" id="introducer" name="introducer" value="0">
                    <input type="button" class="btn-img btn-regist" id="registsubmit" style="cursor:pointer"
                        value="立即注册" tabindex="8">
                </div>
            </form>
        </div>
    </div>

</body>
<script src="../js/comm1.js"></script>
<script src="../js/huakuai.js"></script>

<script>
    (function () {
        /*
           需求：
               * 验证用户名是否存在：select
               * 不存在就可以注册：insert
               * 注册成功可以登陆(存cookie) : select
               * 登陆成功跳转页面，可以退出(查cookie是否含有该用户)
                   * 如果是在注册页、首页跳转到登陆页；本来就在登陆页：登陆成功就跳转到首页 : window.open(url) location.href=url 
                   * 如果是非登陆页登陆的，跳转回上一页(localstorage存上一页路径)
               * 退出：点击退出就删除cookie
       */
        slidingValidation({//配置参数
            ele: 'authcodeDiv',//id
        });
        let cellPhone = document.getElementById('cellPhone');

        let pwd = document.getElementById('pwd');
        let btn = document.getElementById('btn');
        let login = document.getElementById('login');
        // 手机密码
        let cellPhoneinfo = document.getElementById('cellPhone_info');
        let cellPhoneerror = document.getElementById('cellPhone_error');
        // 密码
        let pwdinfo = document.getElementById('pwd-info');
        let pwderror = document.getElementById('pwd_error');
        // 确认密码
        let Repeatsucceed = document.getElementById('pwdRepeat_succeed');

        let Repeaterror = document.getElementById('pwdRepeat_error');
        let resucceed = document.getElementById('Repeat_succeed');

        // 注册按钮
        let registsubmit = document.getElementById('registsubmit');
        let checkbox = document.getElementsByClassName('checkbox')[0];

        let isok = false;

        cellPhone.onfocus = () => {
            cellPhoneinfo.style.display = 'block';
            cellPhoneerror.style.display = 'none';
        }


        cellPhone.onblur = () => {
            cellPhoneinfo.style.display = 'none';
            let val = cellPhone.value.trim();
            console.log(val);
            if (val) {//手机号码非空验证
                var reg = /^1[3-9]\d{9}$/;
                var isok = reg.test(val);
                if (isok) {
                    cellPhoneinfo.style.display = 'block';
                    cellPhoneinfo.innerHTML = '验证通过';
                    cellPhoneinfo.style.color = '#58bc58';
                    ajax({
                        type: 'post',
                        url: '../api/jiekou.php',
                        data: {
                            name: cellPhone.value.trim(),
                            type: 'checkname',
                        },
                        success: str => {
                            console.log(str);
                            if (str == 'yes') {
                                cellPhoneinfo.innerHTML = '可以注册';
                                cellPhoneinfo.style.color = '#58bc58';
                                isok = true;
                            } else {
                                cellPhoneinfo.innerHTML = '不可以注册';
                                cellPhoneinfo.style.color = 'red';
                                isok = false;
                            }
                        }
                    })
                }
            }
            else {
                cellPhoneerror.style.display = 'block';
            }

        }


        pwd.onfocus = () => {
            pwdinfo.style.display = 'block';
            pwderror.style.display = 'none';
        }
        pwd.onblur = () => {
            pwdinfo.style.display = 'none';
            let pasw = pwd.value.trim();
            val = cellPhone.value.trim();
            console.log(pasw);
            if (pasw) {//非空验证
                var reg = /[a-zA-Z][a-zA-Z0-9]{6,20}$/;
                var isok = reg.test(pasw);
                console.log(isok);
                
                if (isok) {
                    pwdinfo.style.display = 'block';
                    ajax({
                        type: 'post',
                        url: '../api/jiekou.php',
                        data: {
                            name: pwd.value.trim(),
                            type: 'checkname'
                        },
                        success: str => {
                            console.log(str);
                            if (str == 'yes') {
                                pwdinfo.innerHTML = '可以注册';
                                pwdinfo.style.color = '#58bc58';
                                console.log(pwdinfo.innerHTML);
                                isok = true;
                            } else {
                                pwdinfo.innerHTML = '不可以注册';
                                pwdinfo.style.color = 'red';
                                isok = false;

                            }
                        }
                    });

                }
            }
            else {
                pwderror.style.display = 'block';
            }

        }


        Repeatsucceed.onfocus = () => {
            resucceed.style.display = 'block';
            Repeaterror.style.display = 'none';
        }
        Repeatsucceed.onblur = () => {
            pasw = pwd.value.trim();
            resucceed.style.display = 'none';
            let Repeatpasw = Repeatsucceed.value.trim();
            val = cellPhone.value.trim();
            // console.log(pasw);
            if (Repeatpasw) {//非空验证
                var reg = /[a-zA-Z][a-zA-Z0-9]{6,20}$/;
                var isok = reg.test(pasw);
                resucceed.style.display = 'block';
                if (Repeatpasw == pasw) {

                    resucceed.innerHTML = '可以注册';
                    resucceed.style.color = '#58bc58';
                    console.log(resucceed.innerHTML);
                    isok = true;
                } else {
                    resucceed.innerHTML = '不可以注册';
                    resucceed.style.color = 'red';
                    isok = false;

                }
            } else {
                Repeaterror.style.display = 'block';
            }

        }

        registsubmit.onclick = function () {
            if (cellPhoneinfo.innerHTML = '可以注册' && (pwdinfo.innerHTML = "可以注册") && (resucceed.innerHTML = '可以注册') && (checkbox.checked == true)) {
                ajax({
                    type: 'post',
                    url: '../api/jiekou.php',
                    data: {
                        name: cellPhone.value.trim(),
                        password: pwd.value.trim(),
                        type: 'reg'
                    },
                    success:str=>{
                        location.href = 'login.html?';
                    }
                });
              

            }
        }

    })();
</script>

</html>